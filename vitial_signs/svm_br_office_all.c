#include <stdlib.h>
#include <stdio.h> 
#include <math.h>
#include "svm_br_office_all.h"

int predict_br (double features_br[]) {
    double vectors_br[166][3] = {{0.8224435322393118, -0.1279831914065368, 0.3894147624871533}, {1.940123204256837, 2.226202314295219, 1.295050068917658}, {-0.2952361397782135, -0.052122935675550174, -0.5967214600705082}, {-0.8540759757869761, -0.37963177280813737, -0.22023241940265068}, {0.26360369623054913, 0.5698560380717659, 0.16705552464811854}, {-0.2952361397782135, 0.241200640184972, -0.1961803164134393}, {0.26360369623054913, -0.40482724755162863, -0.9867747823909805}, {0.8224435322393118, 0.4525438783441029, 0.12198789667208383}, {0.26360369623054913, -0.585024455160344, -0.3655267558272738}, {0.26360369623054913, -0.2954991817584259, 0.5136021513906316}, {0.26360369623054913, -0.011874022821173695, -0.33313004567853977}, {0.26360369623054913, 0.9231149274628536, 0.11215844029741127}, {-0.2952361397782135, 0.5250469228204463, 0.21221457515847417}, {0.26360369623054913, 0.4397149856813799, 0.2666999513177074}, {-0.8540759757869761, 0.11240726673045183, 0.4223023318805642}, {-0.2952361397782135, 0.16843724317445388, -0.5638338906770967}, {0.26360369623054913, -0.8334308346184539, 0.27455369923255263}, {-0.2952361397782135, 0.05110657556860756, 0.2397026928604295}, {-0.2952361397782135, -0.5434436013311414, 0.24215698908381916}, {-0.2952361397782135, -0.38094931681053656, 0.19258020537136286}, {-1.4129158117957388, -0.5684089351154819, -0.8617854521965095}, {0.8224435322393118, -0.14920919519217796, 0.36035221375789334}, {-0.8540759757869761, 0.209751886327131, -0.4671346194755743}, {-0.2952361397782135, -0.5385287801033515, 0.03648696556382858}, {0.26360369623054913, -0.06194106954256875, -0.37338050374211784}, {-1.4129158117957388, -0.7134695006046557, -0.6035934894959972}, {-0.2952361397782135, -0.4668757949794812, 0.3918064741568455}, {-0.2952361397782135, -0.5237144364400395, -0.921408897499408}, {-0.8540759757869761, -0.6456823499987686, 1.1649723690780467}, {-1.4129158117957388, 1.1302456758041701, 0.945558286707079}, {0.8224435322393118, -1.3998342802199633, -0.7969920318990426}, {0.26360369623054913, -1.4106743663218324, 0.07722828287208473}, {-0.2952361397782135, -1.1664878094335247, -0.3238037200296622}, {0.8224435322393118, -0.14963080808981646, 0.5150747291246651}, {0.26360369623054913, 0.21839366859027867, -0.15445728061582764}, {1.940123204256837, 1.5485712466652615, 1.1060692597167128}, {-0.8540759757869761, -1.1926608249017567, -1.4669437262937348}, {-0.8540759757869761, -1.1947416729441365, -0.09671750766438054}, {-0.2952361397782135, -0.00017416621302509264, -0.8765112295368432}, {-0.2952361397782135, 0.8420874632709758, -0.3007333355298063}, {-0.2952361397782135, 0.7203283182347522, -1.065001179493111}, {-0.2952361397782135, 0.7232267523147922, -0.08426440862690514}, {0.8224435322393118, 0.027752401293249445, -0.33655624320639094}, {-0.8540759757869761, 0.4319788922022961, -0.21728726393458356}, {-1.4129158117957388, -1.0384148388000265, -1.2741072177258457}, {-0.8540759757869761, -0.9017388905704092, -0.5010039073583407}, {-0.8540759757869761, -0.6982679009729571, -0.7160002565272089}, {-0.2952361397782135, -0.4427612885723315, 0.6279723554005548}, {-0.8540759757869761, -0.6262365098477901, -0.8568768597497319}, {-0.8540759757869761, -0.5850390056998047, -0.9022414575687965}, {-0.8540759757869761, -0.16003392936525002, -0.8563860005050539}, {-1.4129158117957388, -0.2706591559569517, -0.8983096750189274}, {1.3812833682480743, -1.212998682434177, -1.29963189844909}, {-0.8540759757869761, 0.4383759860793864, -0.8377333492072987}, {-0.2952361397782135, 0.05588356516057512, -0.6001574747832527}, {0.8224435322393118, -1.4408294797318335, -0.4068368562852997}, {-0.2952361397782135, -0.8548329175088333, -1.1749536503009335}, {1.3812833682480743, 2.3411855538449107, 1.4643965083314932}, {1.940123204256837, 1.8432740044391425, 1.3284284975557474}, {1.940123204256837, 1.4916730390063262, 1.2464550036945579}, {0.26360369623054913, -0.7464956639917609, -0.8912370068771764}, {-0.8540759757869761, -0.9297598571524474, -0.419615149572374}, {-0.8540759757869761, -0.07879274976957082, -0.4028320584227848}, {-1.4129158117957388, -0.869258926484132, -0.562142267005126}, {-0.8540759757869761, -0.5328164092824585, -1.2275964635704582}, {-1.4129158117957388, -0.6807567163939139, -1.2952141652469897}, {-0.8540759757869761, -1.1392687433357043, -1.0095340848445218}, {-1.4129158117957388, -1.2435435285834564, 0.01979775124478439}, {1.940123204256837, 1.0370352492578492, 1.3544440375236693}, {-0.2952361397782135, -1.3479556323013353, 0.174575488276582}, {-1.4129158117957388, -0.7668149967633638, -0.1848905537858501}, {-0.8540759757869761, -0.9579117955415398, -1.4189106949057906}, {-0.8540759757869761, -0.584781885681025, -0.8058274983032427}, {-0.8540759757869761, -1.4746294056719593, -0.4956044556668851}, {-0.2952361397782135, 0.06273569339108599, 0.028633217648984532}, {0.8224435322393118, -0.01750909981070828, -0.1382589255414609}, {0.8224435322393118, -0.9842260069912329, -0.6448256660489309}, {-0.2952361397782135, -1.0756767619243837, -1.1248860073437998}, {-1.9717556478045015, -0.36290158492747643, -0.9187251245791324}, {1.940123204256837, -1.0141310250580742, 1.2778699953539363}, {-1.4129158117957388, 0.6153292610955503, 
    0.4522576308610817}, {-0.8540759757869761, -0.46451375961194796, 0.6613507840386432}, {1.3812833682480743, 2.2900974629906177, 2.023485188019485}, {1.3812833682480743, 2.7550205326296844, 1.5954234072355}, {0.8224435322393118, 0.4658670145297467, 1.21945774523728}, {-1.4129158117957388, -0.5986560789565625, -0.9619207381107769}, {-0.8540759757869761, -0.7832669803451469, 0.2765171362112636}, {-1.4129158117957388, -1.2194401310478227, -0.8671849038879651}, {-0.2952361397782135, -0.21684606729266592, -0.6083407119660871}, {-0.2952361397782135, -0.06904500274962362, -0.48136953757123}, {0.8224435322393118, 1.2642255188652798, 0.6235546221984541}, {-0.2952361397782135, 0.4374179217188153, -0.34245637132741796}, {0.26360369623054913, -1.7497694785890048, -0.14954868816905012}, 
    {0.26360369623054913, -0.48650888413358623, 0.9180701690051224}, {-0.2952361397782135, -0.2906488006408699, 1.703444960489572}, {0.8224435322393118, 0.23013327593226768, 0.3472008674448636}, {-0.8540759757869761, -0.571153689631485, -0.46222602702879617}, {0.26360369623054913, 0.29374384703276735, -0.04843168376542711}, {-0.8540759757869761, -0.6409861803896414, -0.8932004438558875}, {-0.2952361397782135, 0.2368302293980758, -0.49628490929481994}, {-0.2952361397782135, 0.2976357819592821, -0.4317927538587737}, {-0.8540759757869761, -0.021158707011139595, -0.7356346263143202}, {-0.8540759757869761, -0.17283600180954772, -0.894673021589921}, {-0.2952361397782135, 0.09920081465385934, -0.7037287754102641}, {-0.8540759757869761, -0.059812756538173736, -0.655624569431842}, {-0.2952361397782135, 0.15062660815822437, -0.5019856258476968}, {-1.4129158117957388, -0.18188117050938926, 1.539988832011871}, {-0.2952361397782135, -0.7344294534841865, -1.0119883810679107}, {-0.8540759757869761, -1.4297405489452366, -0.8828923997176543}, {-1.4129158117957388, -1.3783008526661675, -1.8592114373817596}, {-1.4129158117957388, -1.9525172871669334, -0.72238142670802}, {0.26360369623054913, 0.6162199807170444, -0.14144153416914068}, {-0.8540759757869761, -0.3439291183470362, -0.6397949723650392}, {-0.8540759757869761, 0.18645058958725289, -0.0680660535525384}, {0.8224435322393118, 0.04013441452527348, 0.7384156854530548}, {-1.9717556478045015, -0.6872710937546186, -1.010024944089199}, {1.940123204256837, 0.10346202786482445, 1.068763957121201}, {1.3812833682480743, 1.1880640922781027, 1.4697959600229487}, {0.8224435322393118, 2.1510210107421615, 1.5134824327992706}, {0.8224435322393118, 0.4179513130448998, 0.35799977082777473}, {0.8224435322393118, 1.5946470879926014, 0.984336167036623}, {2.4989630402655996, 1.9637279268149588, 1.6582859099792164}, {1.940123204256837, 0.8214726057157969, 1.2646167957476355}, {-0.2952361397782135, -1.350295719520786, 0.5618560694386807}, {0.26360369623054913, -1.1083501486975653, -1.4379468299884508}, {0.8224435322393118, -1.6809270430391596, -1.2338567596622674}, {-1.4129158117957388, -0.8882292092441086, -1.5313174619370022}, {-1.4129158117957388, -0.8375386052184621, -1.467996619373569}, {-1.9717556478045015, -1.3281428096344279, -1.2863786988427897}, {-1.4129158117957388, -1.418143458189846, -1.6054372078833474}, {0.26360369623054913, -1.763022792828303, -1.814052386871404}, {-0.8540759757869761, -1.0231717771794142, -1.140102643928811}, {0.26360369623054913, 0.5942694103832895, 0.3521094598916417}, {-0.8540759757869761, -0.2985495156361348, -1.0026620554190326}, {-0.8540759757869761, -0.599094611688003, -1.1607187322052779}, {-1.4129158117957388, -0.8579325946945532, -1.4236941182451757}, {0.8224435322393118, 0.18047331831218383, -0.15249384363711663}, {-1.4129158117957388, -0.5305724328449508, -0.657588006410553}, {-0.8540759757869761, -0.3262992036836407, -0.4617351677841187}, {0.8224435322393118, -0.5643678124785814, -0.26686404764703986}, {1.940123204256837, 3.1240087471987597, 2.324769070236204}, {-0.2952361397782135, 0.5240486703247772, 0.8508420868540538}, {-1.4129158117957388, -0.9723395692093589, -1.6989188967360072}, {2.4989630402655996, 1.4099110982874021, 1.9626186416794398}, {1.940123204256837, 0.4080491906567045, 1.4452529977890591}, {-0.2952361397782135, 0.5797300614465619, 0.5975390822305323}, {1.940123204256837, 1.9461748080863515, 1.2577447663221464}, {0.26360369623054913, -1.9550912491317902, -2.356942711485029}, {-0.8540759757869761, -1.2467180861035894, -2.3751854953134792}, {-1.4129158117957388, -1.2216978666901421, -0.42933845763538525}, {-1.4129158117957388, -0.9020621266458136, -1.0615651647803666}, {-0.2952361397782135, -0.6640584050300405, -0.9324691834301101}, {0.26360369623054913, -0.4937686096569457, 0.8921258036276786}, {1.3812833682480743, 0.7922361394194429, 0.09244491945709536}, {-0.8540759757869761, -0.49260496097761874, 0.40953999151894205}, {0.8224435322393118, 0.07886772311218646, 0.8331515196758668}, {-0.8540759757869761, -0.4327067909529855, -1.0978887488865219}, {1.3812833682480743, -1.3617496769466382, -1.8803183849029044}, {-0.8540759757869761, -0.32550751376839243, 0.8439504230587779}, {0.26360369623054913, 0.9283834178349272, 0.11600616320162868}, {-1.4129158117957388, -0.7175894127590506, -0.8455870971221428}, {-0.8540759757869761, -0.40927430599108794, -0.6968567459847756}, {-0.8540759757869761, -1.0699735988890973, -0.9727196414936882}, {-0.8540759757869761, -0.4368512554611827, -0.08475526787158259}, {-0.8540759757869761, 0.18126802708822384, 0.02372462520220641}, {-0.8540759757869761, -0.3884008966240518, -1.2019509087582114}};
    double coefficients_br[1][166] = {{-5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -0.6510769393507773, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -3.063011402373086, -5.0, -5.0, -5.0, -3.857381364717567, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -0.3039264552402705, -5.0, -5.0, -5.0, 
    -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, -5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 2.8753961616817003, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0}};
    double intercepts_br[1] = {-2.8191951107713504};
    int weights_br[2] = {84, 82};
    
    int i_br, j_br, k_br, d_br, l_br;

    double kernels_br[N_VECTORS_BR];
    double kernel_br;
    switch (KERNEL_TYPE_BR) {
        case 'l':
            // <x,x'>
            for (i_br = 0; i_br < N_VECTORS_BR; i_br++) {
                kernel_br = 0.;
                for (j_br = 0; j_br < N_FEATURES_BR; j_br++) {
                    kernel_br += vectors_br[i_br][j_br] * features_br[j_br];
                }
                kernels_br[i_br] = kernel_br;
            }
            break;
        case 'p':
            // (y<x,x'>+r)^d_br
            for (i_br = 0; i_br < N_VECTORS_BR; i_br++) {
                kernel_br = 0.;
                for (j_br = 0; j_br < N_FEATURES_BR; j_br++) {
                    kernel_br += vectors_br[i_br][j_br] * features_br[j_br];
                }
                kernels_br[i_br] = pow((KERNEL_GAMMA_BR * kernel_br) + KERNEL_COEF_BR, KERNEL_DEGREE_BR);
            }
            break;
        case 'r':
            // exp(-y|x-x'|^2)
            for (i_br = 0; i_br < N_VECTORS_BR; i_br++) {
                kernel_br = 0.;
                for (j_br = 0; j_br < N_FEATURES_BR; j_br++) {
                    kernel_br += pow(vectors_br[i_br][j_br] - features_br[j_br], 2);
                }
                kernels_br[i_br] = exp(-KERNEL_GAMMA_BR * kernel_br);
            }
            break;
        case 's':
            // tanh(y<x,x'>+r)
            for (i_br = 0; i_br < N_VECTORS_BR; i_br++) {
                kernel_br = 0.;
                for (j_br = 0; j_br < N_FEATURES_BR; j_br++) {
                    kernel_br += vectors_br[i_br][j_br] * features_br[j_br];
                }
                kernels_br[i_br] = tanh((KERNEL_GAMMA_BR * kernel_br) + KERNEL_COEF_BR);
            }
            break;
    }

    int starts_br[N_ROWS_BR];
    int start_br;
    for (i_br = 0; i_br < N_ROWS_BR; i_br++) {
        if (i_br != 0) {
            start_br = 0;
            for (j_br = 0; j_br < i_br; j_br++) {
                start_br += weights_br[j_br];
            }
            starts_br[i_br] = start_br;
        } else {
            starts_br[0] = 0;
        }
    }

    int ends_br[N_ROWS_BR];
    for (i_br = 0; i_br < N_ROWS_BR; i_br++) {
        ends_br[i_br] = weights_br[i_br] + starts_br[i_br];
    }

    if (N_CLASSES_BR == 2) {

        for (i_br = 0; i_br < N_VECTORS_BR; i_br++) {
            kernels_br[i_br] = -kernels_br[i_br];
        }

        double decision_br = 0.;
        for (k_br = starts_br[1]; k_br < ends_br[1]; k_br++) {
            decision_br += kernels_br[k_br] * coefficients_br[0][k_br];
        }
        for (k_br = starts_br[0]; k_br < ends_br[0]; k_br++) {
            decision_br += kernels_br[k_br] * coefficients_br[0][k_br];
        }
        decision_br += intercepts_br[0];

        if (decision_br > 0) {
            return 0;
        }
        return 1;

    }

    double decisions_br[N_INTERCEPTS_BR];
    double tmp_br;
    for (i_br = 0, d_br = 0, l_br = N_ROWS_BR; i_br < l_br; i_br++) {
        for (j_br = i_br + 1; j_br < l_br; j_br++) {
            tmp_br = 0.;
            for (k_br = starts_br[j_br]; k_br < ends_br[j_br]; k_br++) {
                tmp_br += kernels_br[k_br] * coefficients_br[i_br][k_br];
            }
            for (k_br = starts_br[i_br]; k_br < ends_br[i_br]; k_br++) {
                tmp_br += kernels_br[k_br] * coefficients_br[j_br - 1][k_br];
            }
            decisions_br[d_br] = tmp_br + intercepts_br[d_br];
            d_br = d_br + 1;
        }
    }

    int votes_br[N_INTERCEPTS_BR];
    for (i_br = 0, d_br = 0, l_br = N_ROWS_BR; i_br < l_br; i_br++) {
        for (j_br = i_br + 1; j_br < l_br; j_br++) {
            votes_br[d_br] = decisions_br[d_br] > 0 ? i_br : j_br;
            d_br = d_br + 1;
        }
    }

    int amounts_br[N_CLASSES_BR];
    for (i_br = 0, l_br = N_CLASSES_BR; i_br < l_br; i_br++) {
        amounts_br[i_br] = 0;
    }
    for (i_br = 0; i_br < N_INTERCEPTS_BR; i_br++) {
        amounts_br[votes_br[i_br]] += 1;
    }

    int classVal_br = -1;
    int classIdx_br = -1;
    for (i_br = 0; i_br < N_CLASSES_BR; i_br++) {
        if (amounts_br[i_br] > classVal_br) {
            classVal_br = amounts_br[i_br];
            classIdx_br= i_br;
        }
    }
    return classIdx_br;
}